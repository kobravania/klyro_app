<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Klyro - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –ø–∏—Ç–∞–Ω–∏—é</title>
        <link rel="stylesheet" href="styles.css?v=81">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600&family=Inter:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        // –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏ Telegram Web App API
        (function() {
            let attempts = 0;
            const maxAttempts = 50; // 5 —Å–µ–∫—É–Ω–¥ –º–∞–∫—Å–∏–º—É–º
            
            function checkTelegramAPI() {
                attempts++;
                if (window.Telegram && window.Telegram.WebApp) {
                    console.log('Telegram WebApp API loaded after', attempts * 100, 'ms');
                    window.telegramReady = true;
                } else if (attempts < maxAttempts) {
                    setTimeout(checkTelegramAPI, 100);
                } else {
                    console.log('Telegram WebApp API not loaded after timeout');
                    window.telegramReady = false;
                }
            }
            
            // –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ä–∞–∑—É
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', checkTelegramAPI);
            } else {
                checkTelegramAPI();
            }
        })();
    </script>
</head>
<body>
    <div id="app">
        <!-- Username badge –≤ –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É -->
        <div class="username-badge" id="username-badge"></div>
        
        <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div id="loading-screen" class="screen">
            <div class="logo-container">
                <svg class="logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="45" fill="none" stroke="#5DADE2" stroke-width="3"/>
                    <path d="M 30 30 L 50 50 L 70 30 M 50 50 L 50 70" stroke="#5DADE2" stroke-width="4" stroke-linecap="round" fill="none"/>
                    <circle cx="50" cy="50" r="8" fill="#82E0AA"/>
                </svg>
                <h1 class="app-title">Klyro</h1>
            </div>
        </div>

        <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω / –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
        <div id="auth-screen" class="screen">
            <div class="container">
                <div class="logo-container-small">
                    <svg class="logo-small" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="50" cy="50" r="45" fill="none" stroke="#5DADE2" stroke-width="3"/>
                        <path d="M 30 30 L 50 50 L 70 30 M 50 50 L 50 70" stroke="#5DADE2" stroke-width="4" stroke-linecap="round" fill="none"/>
                        <circle cx="50" cy="50" r="8" fill="#82E0AA"/>
                    </svg>
                </div>
                <h2 class="screen-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Klyro</h2>
                <p class="screen-subtitle">–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –ø–∏—Ç–∞–Ω–∏—é –∏ —Ñ–∏—Ç–Ω–µ—Å—É</p>
                <button id="auth-button" class="btn btn-primary">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram</button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –≤–≤–æ–¥–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ -->
        <div id="onboarding-screen" class="screen">
            <div class="container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                
                <!-- –®–∞–≥ 1: –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è –∏ –ø–æ–ª -->
                <div class="onboarding-step active" data-step="1">
                    <h2 class="screen-title">–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ</h2>
                    <div class="form-group">
                        <label for="dateOfBirth">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                        <input type="text" id="dateOfBirth" class="input date-input" readonly placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É">
                        <div id="datePicker" class="date-picker" style="display: none;">
                            <div class="date-picker-header">
                                <button type="button" class="date-picker-nav" id="prevMonth">&lt;</button>
                                <div class="date-picker-month-year">
                                    <select id="datePickerMonth" class="date-picker-select"></select>
                                    <select id="datePickerYear" class="date-picker-select"></select>
                                </div>
                                <button type="button" class="date-picker-nav" id="nextMonth">&gt;</button>
                            </div>
                            <div class="date-picker-weekdays">
                                <div class="date-picker-weekday">–ü–Ω</div>
                                <div class="date-picker-weekday">–í—Ç</div>
                                <div class="date-picker-weekday">–°—Ä</div>
                                <div class="date-picker-weekday">–ß—Ç</div>
                                <div class="date-picker-weekday">–ü—Ç</div>
                                <div class="date-picker-weekday">–°–±</div>
                                <div class="date-picker-weekday">–í—Å</div>
                            </div>
                            <div id="datePickerDays" class="date-picker-days"></div>
                            <div class="date-picker-actions">
                                <button type="button" class="btn btn-secondary" id="datePickerReset">–°–±—Ä–æ—Å–∏—Ç—å</button>
                                <button type="button" class="btn btn-primary" id="datePickerConfirm">–ì–æ—Ç–æ–≤–æ</button>
                            </div>
                        </div>
                        <input type="hidden" id="dateOfBirthValue" value="">
                    </div>
                    <div class="form-group">
                        <label>–ü–æ–ª</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="gender" value="male" class="radio-input">
                                <span class="radio-custom">–ú—É–∂—Å–∫–æ–π</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="gender" value="female" class="radio-input">
                                <span class="radio-custom">–ñ–µ–Ω—Å–∫–∏–π</span>
                            </label>
                        </div>
                    </div>
                    <button class="btn btn-primary btn-next" onclick="nextStep()">–î–∞–ª–µ–µ</button>
                </div>

                <!-- –®–∞–≥ 2: –†–æ—Å—Ç –∏ –≤–µ—Å -->
                <div class="onboarding-step" data-step="2">
                    <h2 class="screen-title">–§–∏–∑–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h2>
                    <div class="form-group">
                        <label for="height">–†–æ—Å—Ç (—Å–º)</label>
                        <div class="slider-value" id="heightValue">175 —Å–º</div>
                        <input type="range" id="height" class="slider" min="120" max="220" value="175" step="1">
                    </div>
                    <div class="form-group">
                        <label for="weight">–í–µ—Å (–∫–≥)</label>
                        <div class="slider-value" id="weightValue">70.0 –∫–≥</div>
                        <input type="range" id="weight" class="slider" min="40" max="200" value="70" step="0.5">
                    </div>
                    <div class="button-group">
                        <button class="btn btn-secondary" onclick="prevStep()">–ù–∞–∑–∞–¥</button>
                        <button class="btn btn-primary btn-next" onclick="nextStep()">–î–∞–ª–µ–µ</button>
                    </div>
                </div>

                <!-- –®–∞–≥ 3: –£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
                <div class="onboarding-step" data-step="3">
                    <h2 class="screen-title">–£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h2>
                    <div class="form-group">
                        <div class="option-cards">
                            <label class="option-card">
                                <input type="radio" name="activity" value="low" class="radio-input">
                                <div class="card-content">
                                    <div class="card-icon">üèÉ</div>
                                    <div class="card-title">–ù–∏–∑–∫–∏–π</div>
                                    <div class="card-desc">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏</div>
                                </div>
                            </label>
                            <label class="option-card">
                                <input type="radio" name="activity" value="moderate" class="radio-input">
                                <div class="card-content">
                                    <div class="card-icon">üèãÔ∏è</div>
                                    <div class="card-title">–°—Ä–µ–¥–Ω–∏–π</div>
                                    <div class="card-desc">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ 3-4 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é</div>
                                </div>
                            </label>
                            <label class="option-card">
                                <input type="radio" name="activity" value="high" class="radio-input">
                                <div class="card-content">
                                    <div class="card-icon">üí™</div>
                                    <div class="card-title">–í—ã—Å–æ–∫–∏–π</div>
                                    <div class="card-desc">–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ 5+ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é</div>
                                </div>
                            </label>
                        </div>
                    </div>
                    <div class="button-group">
                        <button class="btn btn-secondary" onclick="prevStep()">–ù–∞–∑–∞–¥</button>
                        <button class="btn btn-primary btn-next" onclick="nextStep()">–î–∞–ª–µ–µ</button>
                    </div>
                </div>

                <!-- –®–∞–≥ 4: –¶–µ–ª—å -->
                <div class="onboarding-step" data-step="4">
                    <h2 class="screen-title">–í–∞—à–∞ —Ü–µ–ª—å</h2>
                    <div class="form-group">
                        <div class="option-cards">
                            <label class="option-card">
                                <input type="radio" name="goal" value="lose" class="radio-input">
                                <div class="card-content">
                                    <div class="card-icon">üìâ</div>
                                    <div class="card-title">–°–Ω–∏–∂–µ–Ω–∏–µ –≤–µ—Å–∞</div>
                                    <div class="card-desc">–°–æ–∑–¥–∞—Ç—å –¥–µ—Ñ–∏—Ü–∏—Ç –∫–∞–ª–æ—Ä–∏–π</div>
                                </div>
                            </label>
                            <label class="option-card">
                                <input type="radio" name="goal" value="maintain" class="radio-input">
                                <div class="card-content">
                                    <div class="card-icon">‚öñÔ∏è</div>
                                    <div class="card-title">–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –≤–µ—Å–∞</div>
                                    <div class="card-desc">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π –≤–µ—Å</div>
                                </div>
                            </label>
                            <label class="option-card">
                                <input type="radio" name="goal" value="gain" class="radio-input">
                                <div class="card-content">
                                    <div class="card-icon">üìà</div>
                                    <div class="card-title">–ù–∞–±–æ—Ä –º–∞—Å—Å—ã</div>
                                    <div class="card-desc">–£–≤–µ–ª–∏—á–∏—Ç—å –º—ã—à–µ—á–Ω—É—é –º–∞—Å—Å—É</div>
                                </div>
                            </label>
                        </div>
                    </div>
                    <div class="button-group">
                        <button class="btn btn-secondary" onclick="prevStep()">–ù–∞–∑–∞–¥</button>
                        <button class="btn btn-primary btn-next" onclick="completeOnboarding()">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ø—Ä–æ—Ñ–∏–ª—è -->
        <div id="profile-screen" class="screen">
            <div class="container">
                <div class="profile-header">
                    <h2 id="user-name" class="profile-name"></h2>
                </div>

                <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π Dashboard: –∫–∞–ª–æ—Ä–∏–∏ —Å–µ–≥–æ–¥–Ω—è -->
                <div class="stats-card">
                    <div class="stat-item">
                        <div class="stat-label">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∫–∞–ª–æ—Ä–∏–∏</div>
                        <div class="stat-value" id="calories-value">0</div>
                        <div class="stat-unit">–∫–∫–∞–ª/–¥–µ–Ω—å</div>
                    </div>
                </div>

                <!-- –ë–ª–æ–∫ "–°–µ–≥–æ–¥–Ω—è —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–æ" -->
                <div class="today-stats-card">
                    <div class="today-header">
                        <h3>–°–µ–≥–æ–¥–Ω—è</h3>
                        <span class="today-date" id="today-date"></span>
                    </div>
                    <div class="calories-progress">
                        <div class="calories-consumed">
                            <span class="consumed-value" id="consumed-calories">0</span>
                            <span class="consumed-label">–∏–∑ <span id="target-calories">0</span> –∫–∫–∞–ª</span>
                        </div>
                        <div class="progress-bar-calories">
                            <div class="progress-fill-calories" id="calories-progress-fill"></div>
                        </div>
                    </div>
                </div>

                <!-- –ú–∞–∫—Ä–æ—Å—ã (donut chart) -->
                <div class="macros-card">
                    <h3 class="macros-title">–ú–∞–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç—ã</h3>
                    <div class="macros-container">
                        <div class="macros-chart">
                            <canvas id="macros-chart"></canvas>
                        </div>
                        <div class="macros-legend">
                            <div class="macro-item">
                                <span class="macro-color" style="background: #5DADE2;"></span>
                                <span class="macro-label">–ë–µ–ª–∫–∏</span>
                                <span class="macro-value" id="protein-value">0–≥</span>
                            </div>
                            <div class="macro-item">
                                <span class="macro-color" style="background: #82E0AA;"></span>
                                <span class="macro-label">–£–≥–ª–µ–≤–æ–¥—ã</span>
                                <span class="macro-value" id="carbs-value">0–≥</span>
                            </div>
                            <div class="macro-item">
                                <span class="macro-color" style="background: #F39C12;"></span>
                                <span class="macro-label">–ñ–∏—Ä—ã</span>
                                <span class="macro-value" id="fat-value">0–≥</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <div class="info-row">
                        <span class="info-label">–í–æ–∑—Ä–∞—Å—Ç</span>
                        <span class="info-value" id="profile-age">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">–ü–æ–ª</span>
                        <span class="info-value" id="profile-gender">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">–†–æ—Å—Ç</span>
                        <span class="info-value" id="profile-height">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">–í–µ—Å</span>
                        <span class="info-value" id="profile-weight">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</span>
                        <span class="info-value" id="profile-activity">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">–¶–µ–ª—å</span>
                        <span class="info-value" id="profile-goal">-</span>
                    </div>
                </div>

                <!-- –ë—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ -->
                <div class="quick-actions">
                    <button class="btn btn-primary btn-add-food" onclick="showAddFoodScreen()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 5v14m7-7H5"></path>
                        </svg>
                        –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏—ë–º –ø–∏—â–∏
                    </button>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-icon" onclick="showDiaryScreen()" title="–î–Ω–µ–≤–Ω–∏–∫">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"></path>
                        </svg>
                        –î–Ω–µ–≤–Ω–∏–∫
                    </button>
                    <button class="btn btn-icon" onclick="showHistoryScreen()" title="–ò—Å—Ç–æ—Ä–∏—è">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 3v18h18M7 16l4-4 4 4 6-6"></path>
                        </svg>
                        –ò—Å—Ç–æ—Ä–∏—è
                    </button>
                    <button class="btn btn-icon" onclick="showActivityScreen()" title="–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 9l6 6 6-6"></path>
                        </svg>
                        –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
                    </button>
                    <button class="btn btn-icon" onclick="showSettingsScreen()" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"></path>
                        </svg>
                        –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                    </button>
                    <button class="btn btn-icon" onclick="recalculateCalories()" title="–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 4v6h6"></path>
                            <path d="M23 20v-6h-6"></path>
                            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                        </svg>
                        –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å
                    </button>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –µ–¥—ã -->
        <div id="add-food-screen" class="screen">
            <div class="container">
                <div class="screen-header">
                    <button class="btn-back" onclick="showProfileScreen()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <h2 class="screen-title">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏—ë–º –ø–∏—â–∏</h2>
                </div>

                <div class="search-box">
                    <input type="text" id="food-search" class="input" placeholder="–ü–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–∞..." oninput="searchProducts(this.value)">
                </div>

                <div id="products-list" class="products-list">
                    <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <div id="add-custom-product" class="add-custom-section" style="display: none;">
                    <button class="btn btn-secondary" onclick="showCustomProductForm()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 5v14m7-7H5"></path>
                        </svg>
                        –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π –ø—Ä–æ–¥—É–∫—Ç
                    </button>
                </div>
            </div>
        </div>

        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–≤–æ–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ -->
        <div id="custom-product-screen" class="screen">
            <div class="container">
                <div class="screen-header">
                    <button class="btn-back" onclick="showAddFoodScreen()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <h2 class="screen-title">–ù–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç</h2>
                </div>

                <div class="form-group">
                    <label for="custom-name">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" id="custom-name" class="input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞">
                </div>
                <div class="form-group">
                    <label for="custom-kcal">–ö–∞–ª–æ—Ä–∏–∏ (–Ω–∞ 100–≥)</label>
                    <input type="number" id="custom-kcal" class="input" placeholder="0" min="0">
                </div>
                <div class="form-group">
                    <label for="custom-protein">–ë–µ–ª–∫–∏ (–≥ –Ω–∞ 100–≥)</label>
                    <input type="number" id="custom-protein" class="input" placeholder="0" min="0" step="0.1">
                </div>
                <div class="form-group">
                    <label for="custom-fat">–ñ–∏—Ä—ã (–≥ –Ω–∞ 100–≥)</label>
                    <input type="number" id="custom-fat" class="input" placeholder="0" min="0" step="0.1">
                </div>
                <div class="form-group">
                    <label for="custom-carbs">–£–≥–ª–µ–≤–æ–¥—ã (–≥ –Ω–∞ 100–≥)</label>
                    <input type="number" id="custom-carbs" class="input" placeholder="0" min="0" step="0.1">
                </div>

                <button class="btn btn-primary" onclick="saveCustomProduct()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ -->
        <div id="product-amount-screen" class="screen">
            <div class="container">
                <div class="screen-header">
                    <button class="btn-back" onclick="showAddFoodScreen()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <h2 class="screen-title" id="product-amount-title">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</h2>
                </div>

                <div class="product-info-card">
                    <h3 id="selected-product-name"></h3>
                    <div class="product-macros-preview">
                        <span id="preview-kcal">0 –∫–∫–∞–ª</span>
                        <span id="preview-protein">0–≥ –±–µ–ª–∫–∞</span>
                        <span id="preview-fat">0–≥ –∂–∏—Ä–æ–≤</span>
                        <span id="preview-carbs">0–≥ —É–≥–ª–µ–≤–æ–¥–æ–≤</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="product-grams">–í–µ—Å (–≥—Ä–∞–º–º—ã)</label>
                    <input type="number" id="product-grams" class="input" placeholder="100" min="1" value="100" oninput="updateProductPreview()">
                </div>

                <div class="quick-amounts">
                    <button class="btn-quick" onclick="setQuickAmount(50)">50–≥</button>
                    <button class="btn-quick" onclick="setQuickAmount(100)">100–≥</button>
                    <button class="btn-quick" onclick="setQuickAmount(150)">150–≥</button>
                    <button class="btn-quick" onclick="setQuickAmount(200)">200–≥</button>
                </div>

                <button class="btn btn-primary" onclick="addFoodToDiary()">–î–æ–±–∞–≤–∏—Ç—å –≤ –¥–µ–Ω—å</button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –¥–Ω–µ–≤–Ω–∏–∫–∞ –ø–∏—Ç–∞–Ω–∏—è -->
        <div id="diary-screen" class="screen">
            <div class="container">
                <div class="screen-header">
                    <button class="btn-back" onclick="showProfileScreen()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <h2 class="screen-title">–î–Ω–µ–≤–Ω–∏–∫ –ø–∏—Ç–∞–Ω–∏—è</h2>
                    <button class="btn-icon-small" onclick="changeDiaryDate(-1)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M15 18l-6-6 6-6"></path>
                        </svg>
                    </button>
                    <span class="diary-date" id="diary-date"></span>
                    <button class="btn-icon-small" onclick="changeDiaryDate(1)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 18l6-6-6-6"></path>
                        </svg>
                    </button>
                </div>

                <div class="diary-summary">
                    <div class="summary-item">
                        <span class="summary-label">–ö–∞–ª–æ—Ä–∏–∏</span>
                        <span class="summary-value" id="diary-total-kcal">0</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">–ë–µ–ª–∫–∏</span>
                        <span class="summary-value" id="diary-total-protein">0–≥</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">–ñ–∏—Ä—ã</span>
                        <span class="summary-value" id="diary-total-fat">0–≥</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">–£–≥–ª–µ–≤–æ–¥—ã</span>
                        <span class="summary-value" id="diary-total-carbs">0–≥</span>
                    </div>
                </div>

                <div id="diary-meals" class="diary-meals">
                    <!-- –ü—Ä–∏—ë–º—ã –ø–∏—â–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <button class="btn btn-primary btn-fab" onclick="showAddFoodScreen()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14m7-7H5"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –∏—Å—Ç–æ—Ä–∏–∏ –∏ —Ç—Ä–µ–Ω–¥–æ–≤ -->
        <div id="history-screen" class="screen">
            <div class="container">
                <div class="screen-header">
                    <button class="btn-back" onclick="showProfileScreen()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <h2 class="screen-title">–ò—Å—Ç–æ—Ä–∏—è</h2>
                </div>

                <div class="history-periods">
                    <button class="btn-period active" onclick="setHistoryPeriod(7)">7 –¥–Ω–µ–π</button>
                    <button class="btn-period" onclick="setHistoryPeriod(14)">14 –¥–Ω–µ–π</button>
                    <button class="btn-period" onclick="setHistoryPeriod(30)">30 –¥–Ω–µ–π</button>
                </div>

                <div class="chart-container">
                    <canvas id="calories-chart"></canvas>
                </div>

                <div class="chart-container">
                    <canvas id="weight-chart"></canvas>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ -->
        <div id="activity-screen" class="screen">
            <div class="container">
                <div class="screen-header">
                    <button class="btn-back" onclick="showProfileScreen()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <h2 class="screen-title">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</h2>
                </div>

                <div class="activity-list" id="activity-list">
                    <!-- –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <button class="btn btn-primary" onclick="showAddActivityForm()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14m7-7H5"></path>
                    </svg>
                    –î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
                </button>
            </div>
        </div>

        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
        <div id="add-activity-screen" class="screen">
            <div class="container">
                <div class="screen-header">
                    <button class="btn-back" onclick="showActivityScreen()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <h2 class="screen-title">–ù–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</h2>
                </div>

                <div class="form-group">
                    <label for="activity-name">–í–∏–¥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</label>
                    <select id="activity-name" class="input" onchange="updateActivityCalories()">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</option>
                        <option value="running" data-met="11.5">–ë–µ–≥ (10 –∫–º/—á)</option>
                        <option value="running-fast" data-met="16">–ë–µ–≥ (15 –∫–º/—á)</option>
                        <option value="walking" data-met="3.5">–•–æ–¥—å–±–∞</option>
                        <option value="cycling" data-met="8">–í–µ–ª–æ—Å–∏–ø–µ–¥</option>
                        <option value="swimming" data-met="8">–ü–ª–∞–≤–∞–Ω–∏–µ</option>
                        <option value="gym" data-met="5">–¢—Ä–µ–Ω–∞–∂—ë—Ä–Ω—ã–π –∑–∞–ª</option>
                        <option value="yoga" data-met="3">–ô–æ–≥–∞</option>
                        <option value="pilates" data-met="3">–ü–∏–ª–∞—Ç–µ—Å</option>
                        <option value="dancing" data-met="6">–¢–∞–Ω—Ü—ã</option>
                        <option value="basketball" data-met="8">–ë–∞—Å–∫–µ—Ç–±–æ–ª</option>
                        <option value="football" data-met="7">–§—É—Ç–±–æ–ª</option>
                        <option value="tennis" data-met="7">–¢–µ–Ω–Ω–∏—Å</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="activity-duration">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω—É—Ç—ã)</label>
                    <input type="number" id="activity-duration" class="input" placeholder="30" min="1" value="30" oninput="updateActivityCalories()">
                </div>

                <div class="activity-preview">
                    <div class="preview-calories">
                        –°–æ–∂–∂–µ–Ω–æ: <span id="activity-calories">0</span> –∫–∫–∞–ª
                    </div>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="add-to-diary" checked>
                        <span>–£—á–µ—Å—Ç—å –∫–∞–ª–æ—Ä–∏–∏ –≤ –¥–Ω–µ–≤–Ω–∏–∫–µ</span>
                    </label>
                </div>

                <button class="btn btn-primary" onclick="saveActivity()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
        <div id="settings-screen" class="screen">
            <div class="container">
                <div class="screen-header">
                    <button class="btn-back" onclick="showProfileScreen()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <h2 class="screen-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                </div>

                <div class="settings-section">
                    <h3 class="section-title">–ü—Ä–æ—Ñ–∏–ª—å</h3>
                    <button class="btn btn-secondary" onclick="editProfile()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
                    </button>
                </div>

                <div class="settings-section">
                    <h3 class="section-title">–î–∞–Ω–Ω—ã–µ</h3>
                    <button class="btn btn-secondary" onclick="exportData()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (CSV)
                    </button>
                    <button class="btn btn-secondary" onclick="document.getElementById('import-file').click()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (CSV)
                    </button>
                    <input type="file" id="import-file" accept=".csv" style="display: none;" onchange="importData(event)">
                </div>

                <div class="settings-section">
                    <h3 class="section-title">–ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è</h3>
                    <div class="form-group">
                        <label class="radio-label">
                            <input type="radio" name="units" value="metric" checked class="radio-input" onchange="setUnits('metric')">
                            <span class="radio-custom">–ú–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ (–∫–≥, —Å–º)</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="units" value="imperial" class="radio-input" onchange="setUnits('imperial')">
                            <span class="radio-custom">–ò–º–ø–µ—Ä—Å–∫–∏–µ (—Ñ—É–Ω—Ç—ã, –¥—é–π–º—ã)</span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="section-title">–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</h3>
                    <div class="info-text">
                        <p>Klyro v1.0</p>
                        <p>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –ø–∏—Ç–∞–Ω–∏—é –∏ —Ñ–∏—Ç–Ω–µ—Å—É</p>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="section-title">–û—Ç–ª–∞–¥–∫–∞</h3>
                    <button class="btn btn-secondary" onclick="showDebugScreen()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                        </svg>
                        –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ –∏ –æ—à–∏–±–∫–∏
                    </button>
                    <button class="btn btn-secondary" onclick="clearDebugLogs()">
                        –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
                    </button>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –æ—Ç–ª–∞–¥–∫–∏ -->
        <div id="debug-screen" class="screen">
            <div class="container">
                <div class="screen-header">
                    <button class="btn-back" onclick="showSettingsScreen()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <h2 class="screen-title">–õ–æ–≥–∏ –∏ –æ—à–∏–±–∫–∏</h2>
                    <button class="btn-icon-small" onclick="exportDebugLogs()" title="–≠–∫—Å–ø–æ—Ä—Ç">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                    </button>
                </div>

                <div class="debug-controls">
                    <label class="checkbox-label">
                        <input type="checkbox" id="debug-auto-scroll" checked>
                        <span>–ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="debug-show-info">
                        <span>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å INFO</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="debug-show-warn" checked>
                        <span>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å WARN</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="debug-show-error" checked>
                        <span>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å ERROR</span>
                    </label>
                </div>

                <div id="debug-logs" class="debug-logs">
                    <div class="debug-log-entry info">–õ–æ–≥–∏ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è –∑–¥–µ—Å—å...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ app.js —Å timestamp –¥–ª—è –æ–±—Ö–æ–¥–∞ –∫—ç—à–∞
        (function() {
            const script = document.createElement('script');
            script.src = 'app.js?v=' + Date.now();
            script.async = false;
            document.head.appendChild(script);
        })();
    </script>

    <script>
        // –ö–†–ò–¢–ò–ß–ù–û: –°–∫—Ä—ã–≤–∞–µ–º loading screen –°–†–ê–ó–£ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ HTML
        (function() {
            try {
                const loadingScreen = document.getElementById('loading-screen');
                if (loadingScreen) {
                    loadingScreen.style.display = 'none';
                    loadingScreen.style.visibility = 'hidden';
                    loadingScreen.style.opacity = '0';
                    loadingScreen.classList.remove('active');
                    console.log('[HTML] Loading screen hidden immediately in HTML');
                }
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã
                const allScreens = document.querySelectorAll('.screen');
                allScreens.forEach(screen => {
                    if (screen.id !== 'loading-screen') {
                        screen.style.display = 'none';
                        screen.style.visibility = 'hidden';
                        screen.style.opacity = '0';
                        screen.classList.remove('active');
                    }
                });
            } catch (e) {
                console.error('[HTML] Error hiding screens:', e);
            }
        })();
    </script>
</body>
</html>

